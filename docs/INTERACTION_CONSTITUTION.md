# 交互底层宪法遵守情况文档

> 本文档记录「余音 / Echo」应用对【交互底层宪法】的遵守情况，确保所有功能开发均符合宪法要求。

## 宪法总览

1. **禁止装饰性按钮**：任何可点击元素必须有真实、可验证的功能结果；未实现的功能不得展示。
2. **返回规则**：所有"返回"按钮只能返回用户的上一级页面，不允许统一跳转到模块首页或余音首页；同一页面不得出现两个语义相同但返回结果不同的返回按钮。
3. **默认私密**：所有用户输入内容（心事、夸夸、时间胶囊）默认仅本地保存，仅用户本人可见。
4. **时间胶囊未解锁前禁止任何形式的内容预览**：包括列表摘要、部分正文、hover 显示。
5. **保存/创建行为必须给出明确反馈**：禁止让用户通过刷新或回看确认是否成功。
6. **不制造焦虑**：不强制打卡、不倒计时施压、不使用红点或进度条制造心理压力。
7. **余音板块不进行心理分析、不评判、不提出"你应该怎样"的建议**，仅作为情绪容器与陪伴空间。
8. **同类功能交互保持一致**：返回逻辑、保存反馈、私密规则一致。

---

## 规则遵守情况

### ✅ 规则1：禁止装饰性按钮

**遵守情况**：所有可点击元素都有真实功能。

**检查清单**：
- [x] 余音首页功能卡片（写心事、今日夸夸、时间胶囊）- 整个卡片可点击，跳转到对应功能
- [x] 写心事页面保存按钮 - 保存记录到 localStorage 并显示反馈
- [x] 今日夸夸页面保存按钮 - 保存记录到 localStorage 并显示反馈
- [x] 时间胶囊页面保存按钮 - 保存胶囊到 localStorage 并显示 toast
- [x] 返回按钮 - 使用 `useNavigationBack` Hook，基于历史导航返回
- [x] 关闭提醒按钮 - 隐藏时间胶囊提醒卡片

**相关文件**：
- `src/app/resonance/page.tsx`
- `src/app/resonance/heart/page.tsx`
- `src/app/resonance/praise/page.tsx`
- `src/app/resonance/capsule/page.tsx`

---

### ✅ 规则2：返回规则

**遵守情况**：已使用统一的 `useNavigationBack` Hook，所有返回按钮基于历史导航。

**实现方案**：
- 创建 `src/hooks/use-navigation-back.ts`
- 优先使用 `window.history.back()` 返回上一访问页面
- 当无历史记录时，fallback 到指定的模块首页
- 同一页面只有一个主返回入口

**检查清单**：
- [x] 写心事页面 - 返回按钮使用 `handleBack()`
- [x] 今日夸夸页面 - 返回按钮使用 `handleBack()`
- [x] 时间胶囊页面 - 返回按钮使用 `handleBack()`
- [x] 无重复或歧义的返回按钮

**相关文件**：
- `src/hooks/use-navigation-back.ts`
- `src/app/resonance/heart/page.tsx`
- `src/app/resonance/praise/page.tsx`
- `src/app/resonance/capsule/page.tsx`

---

### ✅ 规则3：默认私密

**遵守情况**：所有用户数据仅使用 localStorage 保存，无云端上传。

**实现方案**：
- 使用 `localStorage` 作为唯一存储方案
- 所有 CRUD 操作通过 `src/lib/storage.ts` 管理
- 无 API 调用、无网络请求

**检查清单**：
- [x] 写心事记录 - 仅保存在 localStorage
- [x] 今日夸夸记录 - 仅保存在 localStorage
- [x] 时间胶囊 - 仅保存在 localStorage
- [x] 无账号系统、无云端同步

**相关文件**：
- `src/lib/storage.ts`

---

### ✅ 规则4：时间胶囊未解锁前禁止任何形式的内容预览

**遵守情况**：已通过类型系统和逻辑判断确保未解锁时无法访问 `content`。

**实现方案**：
- 新增 `SafeCapsule` 类型，不包含 `content` 字段
- 新增 `isCapsuleUnlocked()` 函数，基于时间判断解锁状态
- 新增 `getSafeCapsule()` 函数，将 `Capsule` 转换为 `SafeCapsule`
- 在 `handleViewCapsule` 函数中，数据获取前进行解锁判断
- 列表页不渲染 `content` 字段

**检查清单**：
- [x] 未解锁时列表页不显示正文
- [x] 未解锁时详情页显示锁定说明，不显示正文
- [x] 刷新页面后逻辑依然有效
- [x] 使用类型系统从源头防止 `content` 访问

**相关文件**：
- `src/lib/storage.ts`
- `src/app/resonance/capsule/page.tsx`

---

### ✅ 规则5：保存/创建行为必须给出明确反馈

**遵守情况**：所有保存操作都有明确的用户反馈。

**实现方案**：
- 写心事：显示温柔反馈文案（如"已收好"、"这段心事被温柔地保存了"）
- 今日夸夸：根据语气模式显示不同反馈
- 时间胶囊：使用 toast 提示（如"这封信已为你妥善保存"）

**检查清单**：
- [x] 写心事保存 - 显示 `showFeedback` 状态，3秒后自动隐藏
- [x] 今日夸夸保存 - 显示 `showFeedback` 状态，根据语气显示不同文案
- [x] 时间胶囊保存 - 显示 toast，成功/失败都有提示
- [x] 用户无需刷新或回看即可确认保存成功

**相关文件**：
- `src/lib/write-heart-text.ts` - 保存反馈文案库
- `src/lib/praise-text.ts` - 保存反馈文案库
- `src/app/resonance/heart/page.tsx`
- `src/app/resonance/praise/page.tsx`
- `src/app/resonance/capsule/page.tsx`

---

### ✅ 规则6：不制造焦虑

**遵守情况**：无强制打卡、无精确倒计时、无红点、无进度条。

**检查清单**：
- [x] 无强制打卡功能
- [x] 无精确倒计时（时间胶囊只显示天数，不显示小时、分钟、秒）
- [x] 无红点提醒
- [x] 无进度条压力
- [x] 时间胶囊的"X天后解锁"显示用户自设定的解锁时间，不是系统强制的
- [x] 时间胶囊提醒卡片使用温和的蓝色，非红色警示

**说明**：
时间胶囊显示的"X天后解锁"是用户自己设定的解锁时间，不是系统强制的时间限制，因此不会制造焦虑。

---

### ✅ 规则7：余音板块不进行心理分析、不评判、不提出"你应该怎样"的建议

**遵守情况**：所有文案都是陪伴式、记录式，无分析、评判、建议。

**检查清单**：
- [x] 写心事占位文案 - 开放式引导（如"此刻我最想说的一句话是……"）
- [x] 写心事保存反馈 - 温柔陪伴（如"已收好"、"你不需要独自承受"）
- [x] 今日夸夸文案 - 自我肯定（如"我今天做对的一件小事"）
- [x] 模块说明 - 明确声明"没有评判，没有分析，只有陪伴"
- [x] 无"分析"、"诊断"、"评估"、"你应该"等词汇

**相关文件**：
- `src/lib/write-heart-text.ts`
- `src/lib/praise-text.ts`
- `src/app/resonance/page.tsx`

---

### ✅ 规则8：同类功能交互保持一致

**遵守情况**：返回逻辑、保存反馈、私密规则在同类功能中保持一致。

**检查清单**：
- [x] 返回逻辑 - 所有子页面使用统一的 `useNavigationBack` Hook
- [x] 保存反馈 - 所有保存操作都有明确反馈
- [x] 私密规则 - 所有数据仅本地保存，无云端上传
- [x] 交互风格 - 统一使用 shadcn/ui 组件库和苹果风格设计

---

## 未来开发指南

### 新增功能时必须遵守：

1. **实现功能后再展示按钮**：不要先放一个"功能开发中"的按钮
2. **返回按钮使用 `useNavigationBack`**：不要写死返回路径
3. **数据默认私密**：除非用户明确授权，否则仅保存在 localStorage
4. **时间相关功能要考虑焦虑感**：避免精确倒计时和强制时间限制
5. **文案审查**：确保不包含分析、评判、建议性内容
6. **保存必须有反馈**：使用 toast 或状态提示

### 违规检查清单：

在 PR 或功能上线前，请确认：

- [ ] 所有按钮都有真实功能
- [ ] 返回按钮使用 `useNavigationBack` Hook
- [ ] 无云端数据上传
- [ ] 无时间胶囊内容泄露
- [ ] 保存操作有明确反馈
- [ ] 无制造焦虑的元素（红点、倒计时、进度条）
- [ ] 文案不包含分析、评判、建议
- [ ] 同类功能交互一致

---

## 更新记录

- **2025-04-XX**：初始版本，完成全部 8 条规则的检查和验证
- **2025-04-XX**：修复时间胶囊解锁逻辑，确保未解锁时不泄露内容
- **2025-04-XX**：统一返回逻辑，使用 `useNavigationBack` Hook

---

## 备注

本文档应随着功能迭代持续更新。任何新功能开发都必须在开发前阅读本文档，并在上线前通过违规检查清单的验证。
